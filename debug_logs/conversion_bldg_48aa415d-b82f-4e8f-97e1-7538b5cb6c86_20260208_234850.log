================================================================================
CITYGML TO STEP CONVERSION LOG
================================================================================
Building ID: bldg_48aa415d-b82f-4e8f-97e1-7538b5cb6c86
Timestamp: 2026-02-08T23:48:50.009541
Precision mode: standard
Shape fix level: minimal
Debug mode: Enabled
================================================================================

LOG LEGEND (for AI/LLM Analysis and Debugging):
--------------------------------------------------------------------------------
  [PHASE:N]       = Major processing phase (1-7)
  ✓ SUCCESS       = Operation completed successfully
  ✗ FAILED        = Operation failed
  ⚠ WARNING       = Potential issue detected
--------------------------------------------------------------------------------

PROCESSING PHASES:
  [PHASE:1] LOD Strategy Selection (LOD3→LOD2→LOD1 fallback)
  [PHASE:2] Geometry Extraction
  [PHASE:3] Shell Construction
  [PHASE:4] Solid Validation
  [PHASE:5] Automatic Repair
  [PHASE:6] BuildingPart Merging
  [PHASE:7] STEP Export
================================================================================


================================================================================
[PHASE:1.5] COORDINATE SYSTEM DETECTION
================================================================================
[CRS] Source coordinate system:
  - CRS code: EPSG:6697
  - CRS name: JGD2011 / (vertical) / height
  - Sample coordinates: lat=35.682388°, lon=139.771692°
  - Is geographic CRS: True

[CRS] Auto-reprojection selected:
  - Target CRS: EPSG:6677
  - Target name: JGD2011 / Japan Plane Rectangular CS IX

[CRS] Setting up coordinate transformation:
  - From: EPSG:6697
  - To: EPSG:6677
  - ✓ Transformation setup successful

================================================================================
[PHASE:0] PRE-SCAN FOR COORDINATE RE-CENTERING
================================================================================
[PRESCAN] Scanned 93 coordinates from 1 buildings
[PRESCAN] ✓ Applied xyz_transform to get planar coordinates
[PRESCAN] Bounding box center: (-5580.815, -35232.120, 6.005) meters
[PRESCAN] Distance from origin: 35671.386 m (35.671 km)
[PRESCAN] ✓ Offset calculated: (5580.815, 35232.120, -6.005) meters
[PRESCAN] This will re-center geometry to origin for numerical precision
[PRESCAN] ✓ Wrapped xyz_transform with offset
[PRESCAN] DEBUG: Sample coordinate (35.682, 139.772, 0.000)
[PRESCAN] DEBUG: Original transform → (-5579.460, -35235.700, 0.000)
[PRESCAN] DEBUG: Wrapped transform → (1.355, -3.580, -6.005)

================================================================================
[PHASE:2] BUILDING GEOMETRY EXTRACTION (Solid Method)
================================================================================
[INFO] Total buildings to process: 1
[INFO] Limit: 1
[INFO] BuildingPart merging: enabled


────────────────────────────────────────────────────────────────────────────────
[BUILDING 1/1] Processing: bldg_48aa415d-b82f-4e8f-97e1-7538b5cb6c86

================================================================================
[PHASE:1] LOD STRATEGY SELECTION
================================================================================
[INFO] Building ID: bldg_48aa415d-b82f-4e8f-97e1-7538b5cb6c86
[INFO] Strategy: LOD3 → LOD2 → LOD1 (with fallback to boundedBy)

[CONVERSION DEBUG] LOD3 Strategy 1: lod3Solid not found
[LOD3] No LOD3 geometry found, will fall back to LOD2 for bldg_48aa415d-b82f-4e8f-97e1-7538b5cb6c86
[PHASE:1] LOD3 extraction failed, falling back to LOD2
[CONVERSION DEBUG] Falling back to LOD2 (PLATEAU's most common LOD)
[CONVERSION DEBUG] Trying LOD2 Strategy 1: lod2Solid
[CONVERSION DEBUG]   ✓ Found bldg:lod2Solid//gml:Solid
[LOD2] Found bldg:lod2Solid//gml:Solid in bldg_48aa415d-b82f-4e8f-97e1-7538b5cb6c86
  [Solid] Extracting shells from gml:Solid element
  [Solid] XML structure dumped to: /var/folders/bb/6dpdt_x9047d6_68y3pmbdc00000gn/T/plateau_solid_debug.xml
  [Solid] Found gml:exterior element
  [Solid] Found 10 gml:surfaceMember elements in exterior
  [Solid]   surfaceMember[0]: XLink reference: #poly-bb163103-edef-4d57-bfd8-2209a88199a0
  [Solid]   surfaceMember[0]: Target ID 'poly-bb163103-edef-4d57-bfd8-2209a88199a0' in index: True
  [Solid]   surfaceMember[0]: Polygon found
  [Solid]   surfaceMember[0]: Extracted 5 vertices, 0 holes
  [Level 1] Success: Normal face creation (5 vertices)
  [Solid]   surfaceMember[0]: ✓ Face created successfully
  [Solid]   surfaceMember[1]: XLink reference: #poly-937e76bb-9ee6-4ed0-ba72-273395772a89
  [Solid]   surfaceMember[1]: Polygon found
  [Solid]   surfaceMember[1]: Extracted 7 vertices, 0 holes
  [Level 1] Success: Normal face creation (7 vertices)
  [Solid]   surfaceMember[1]: ✓ Face created successfully
  [Solid]   surfaceMember[2]: XLink reference: #poly-c55446f0-dea1-45f6-a8ca-63171d5f44d4
  [Solid]   surfaceMember[2]: Polygon found
  [Solid]   surfaceMember[2]: Extracted 7 vertices, 0 holes
  [Level 1] Success: Normal face creation (7 vertices)
  [Solid]   surfaceMember[2]: ✓ Face created successfully
  [Solid]   surfaceMember[3]: XLink reference: #poly-d77b88a8-c9ae-4fa8-9859-97dfd7958caa
  [Solid]   surfaceMember[3]: Polygon found
  [Solid]   surfaceMember[3]: Extracted 5 vertices, 0 holes
  [Level 1] Success: Normal face creation (5 vertices)
  [Solid]   surfaceMember[3]: ✓ Face created successfully
  [Solid]   surfaceMember[4]: XLink reference: #poly-9295a4cd-b4dc-4780-ad08-0bb76ec13ec8
  [Solid]   surfaceMember[4]: Polygon found
  [Solid]   surfaceMember[4]: Extracted 5 vertices, 0 holes
  [Level 1] Success: Normal face creation (5 vertices)
  [Solid]   surfaceMember[4]: ✓ Face created successfully
  [Solid]   surfaceMember[5]: XLink reference: #poly-09b9bf25-8d95-453e-bd1f-3062f9b9f287
  [Solid]   surfaceMember[5]: Polygon found
  [Solid]   surfaceMember[5]: Extracted 5 vertices, 0 holes
  [Level 1] Success: Normal face creation (5 vertices)
  [Solid]   surfaceMember[5]: ✓ Face created successfully
  [Solid]   surfaceMember[6]: XLink reference: #poly-eadabcae-3ace-4323-ab8c-43d35e6672a7
  [Solid]   surfaceMember[6]: Polygon found
  [Solid]   surfaceMember[6]: Extracted 7 vertices, 0 holes
  [Level 1] Failed, trying Level 2: Plane projection (7 vertices)...
  [Level 2] Failed: Wrong number or type of arguments for overloaded function 'new_GeomPlate_BuildAveragePlane'.
  Possible C/C++ prototypes are:
    GeomPlate_BuildAveragePlane::GeomPlate_BuildAveragePlane(opencascade::handle< TColgp_HArray1OfPnt > const &,Standard_Integer const,Standard_Real const,Standard_Integer const,Standard_Integer const)
    GeomPlate_BuildAveragePlane::GeomPlate_BuildAveragePlane(TColgp_SequenceOfVec const &,opencascade::handle< TColgp_HArray1OfPnt > const &)

  [Level 2] Failed, trying Level 3: ShapeFix repair...
  [Level 3] Failed, trying Level 4: Triangulation (last resort)...
  [Level 4] Success: Created 5/5 triangle faces
  [Solid]   surfaceMember[6]: ✓ Face created successfully
  [Solid]   surfaceMember[7]: XLink reference: #poly-10efa272-f870-4169-86a0-1971c69363db
  [Solid]   surfaceMember[7]: Polygon found
  [Solid]   surfaceMember[7]: Extracted 5 vertices, 0 holes
  [Level 1] Success: Normal face creation (5 vertices)
  [Solid]   surfaceMember[7]: ✓ Face created successfully
  [Solid]   surfaceMember[8]: XLink reference: #poly-3c61fd75-34e3-42b3-a99f-cde2bc5a3552
  [Solid]   surfaceMember[8]: Polygon found
  [Solid]   surfaceMember[8]: Extracted 7 vertices, 0 holes
  [Level 1] Failed, trying Level 2: Plane projection (7 vertices)...
  [Level 2] Failed: Wrong number or type of arguments for overloaded function 'new_GeomPlate_BuildAveragePlane'.
  Possible C/C++ prototypes are:
    GeomPlate_BuildAveragePlane::GeomPlate_BuildAveragePlane(opencascade::handle< TColgp_HArray1OfPnt > const &,Standard_Integer const,Standard_Real const,Standard_Integer const,Standard_Integer const)
    GeomPlate_BuildAveragePlane::GeomPlate_BuildAveragePlane(TColgp_SequenceOfVec const &,opencascade::handle< TColgp_HArray1OfPnt > const &)

  [Level 2] Failed, trying Level 3: ShapeFix repair...
  [Level 3] Failed, trying Level 4: Triangulation (last resort)...
  [Level 4] Success: Created 5/5 triangle faces
  [Solid]   surfaceMember[8]: ✓ Face created successfully
  [Solid]   surfaceMember[9]: XLink reference: #poly-ac0f4dc8-29c6-4891-b74c-8ec014d7a695
  [Solid]   surfaceMember[9]: Polygon found
  [Solid]   surfaceMember[9]: Extracted 5 vertices, 0 holes
  [Level 1] Success: Normal face creation (5 vertices)
  [Solid]   surfaceMember[9]: ✓ Face created successfully
  [Solid] Extraction complete: 18 exterior faces, 0 interior shells
[CONVERSION DEBUG]   Extracted 18 exterior faces, 0 interior shells
[LOD2] Solid extraction: 18 exterior faces, 0 interior shells
[CONVERSION DEBUG]   Checking if boundedBy has more detailed geometry...
[CONVERSION DEBUG]   Found 10 boundedBy faces
[CONVERSION DEBUG]   Comparing lod2Solid (18 faces) vs boundedBy (10 faces)...
[CONVERSION DEBUG]   → lod2Solid has more detail (18 vs 10 faces), using it
[PHASE:1] ✓ LOD2 extraction succeeded with 18 faces
[PHASE:1] Method: lod2Solid//gml:Solid
Auto-computed tolerance: 0.000836 (precision_mode: standard)
Attempting to build exterior shell from 18 faces...
Building shell from 18 faces with tolerance 0.000836000
Stage 4: Single-pass sewing...
[SEWING DIAGNOSTIC] Input: 18 faces → Output: 18 faces in sewn shape
Stage 6: Extracting and validating shell...
[SHELL DIAGNOSTIC] Found 1 shell(s) in sewn shape
[SHELL DIAGNOSTIC] Extracted shell contains 18 faces
Shell construction complete
Exterior shell is closed, will attempt to create solid

[PHASE:4] SOLID VALIDATION
[VALIDATION] ✓ Initial solid validation succeeded
[INFO] Created valid solid with 0 cavities
[BUILDING] Extracted geometry from main Building element
└─ [RESULT] ✓ Successfully added (total: 1)

================================================================================
[PHASE:2] EXTRACTION SUMMARY (Solid Method)
================================================================================
[INFO] Shapes extracted: 1


================================================================================
[PHASE:7] STEP EXPORT PREPARATION
================================================================================
[INFO] Total shapes extracted: 1

[VALIDATION] Pre-export shape validation:
  ✓ Valid shapes: 1
  ⚠ Invalid shapes: 0

[INFO] Proceeding to STEP export with 1 shape(s)...
[INFO] Target file: /var/folders/bb/6dpdt_x9047d6_68y3pmbdc00000gn/T/gml2step_e2e_cjnxdiyc/tokyo_station_1bldg.step
STEP writer configured: AP214CD schema, MM units, 1e-6 precision
[STEP EXPORT] Using local STEP writer...
[STEP EXPORT] Configuration: AP214CD schema, MM units, 1e-6 precision
[STEP EXPORT] Transferring geometry to STEP format...
[STEP EXPORT] ✓ Transfer successful
[STEP EXPORT] Writing to file: /var/folders/bb/6dpdt_x9047d6_68y3pmbdc00000gn/T/gml2step_e2e_cjnxdiyc/tokyo_station_1bldg.step
[STEP EXPORT] ✓ File written successfully
  - File: /var/folders/bb/6dpdt_x9047d6_68y3pmbdc00000gn/T/gml2step_e2e_cjnxdiyc/tokyo_station_1bldg.step
  - Size: 46,765 bytes (45.7 KB)
